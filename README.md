# ü¶∑ Cl√≠nica Dental ‚Äì Backend API

![Node.js](https://img.shields.io/badge/Node.js-20.x-green?logo=node.js&logoColor=white)
![NestJS](https://img.shields.io/badge/NestJS-9.x-red?logo=nestjs&logoColor=white)
![MySQL](https://img.shields.io/badge/MySQL-8.x-blue?logo=mysql&logoColor=white)
![JWT](https://img.shields.io/badge/Auth-JWT-yellow?logo=jsonwebtokens)
![Swagger](https://img.shields.io/badge/API-Swagger-85EA2D?logo=swagger&logoColor=black)
![TypeORM](https://img.shields.io/badge/ORM-TypeORM-lightgrey?logo=typescript)
![TypeScript](https://img.shields.io/badge/TypeScript-5.x-blue?logo=typescript)
![License](https://img.shields.io/badge/Licencia-Educativa-lightgrey)
![Estado](https://img.shields.io/badge/Estado-En%20Desarrollo-orange)
![npm](https://img.shields.io/badge/npm-10.x-CB3837?logo=npm)
![ESLint](https://img.shields.io/badge/code_style-ESLint-purple?logo=eslint)
![Prettier](https://img.shields.io/badge/formatter-Prettier-F7B93E?logo=prettier)
![Postman](https://img.shields.io/badge/Tested_with-Postman-orange?logo=postman)

Este repositorio contiene el backend de una aplicaci√≥n de gesti√≥n de citas para una cl√≠nica dental. Est√° desarrollado con [NestJS](https://nestjs.com/) y utiliza una base de datos relacional MySQL, conectada a trav√©s de TypeORM.

---

## ‚öôÔ∏è Tecnolog√≠as utilizadas


El backend de la aplicaci√≥n est√° construido con **NestJS** y una serie de librer√≠as modernas que permiten una arquitectura robusta, segura y escalable.

- **Framework:** NestJS
- **Base de datos:** MySQL
- **ORM:** TypeORM
- **Autenticaci√≥n:** JWT
- **Control de acceso:** Por roles (`admin`, `dentista`)
- **Documentaci√≥n de la API:** Swagger (`http://localhost:3000/api`)
- **Gestor de paquetes:** npm


### üì¶ Dependencias principales

| Paquete                      | Descripci√≥n                                                                 |
|-----------------------------|-----------------------------------------------------------------------------|
| **@nestjs/core**, **common**, **platform-express** | N√∫cleo del framework NestJS, basado en m√≥dulos y decoradores.         |
| **@nestjs/config**          | Gesti√≥n centralizada de configuraci√≥n y variables de entorno (.env).        |
| **@nestjs/typeorm**         | Integraci√≥n de TypeORM con NestJS. ORM para trabajar con MySQL.             |
| **mysql2**                  | Driver oficial para conexi√≥n a MySQL.                                       |
| **@nestjs/jwt**, **passport-jwt** | Implementaci√≥n de autenticaci√≥n basada en JWT.                        |
| **@nestjs/passport**, **passport** | Estrategia Passport para NestJS.                                      |
| **@nestjs/swagger**, **swagger-ui-express** | Documentaci√≥n autom√°tica e interactiva de la API.              |
| **bcrypt**                  | Hashing seguro de contrase√±as.                                              |
| **class-validator**         | Validaci√≥n autom√°tica de DTOs (Data Transfer Objects).                     |
| **class-transformer**       | Transformaci√≥n de objetos seg√∫n clases definidas.                          |
| **dayjs**                   | Manejo ligero y moderno de fechas.                                          |
| **reflect-metadata**        | Permite el uso de decoradores en TypeScript.                               |
| **rxjs**                    | Programaci√≥n reactiva. Base de los controladores en NestJS.                 |
| **typeorm**                 | ORM para definir entidades, relaciones, migraciones, etc.                   |

---

### üß™ Dependencias de desarrollo (devDependencies)

| Paquete           | Descripci√≥n                                                             |
|------------------|-------------------------------------------------------------------------|
| **@nestjs/cli**   | CLI oficial para generaci√≥n y gesti√≥n del proyecto NestJS.              |
| **@types/**       | Tipados necesarios para paquetes externos usados con TypeScript.        |
| **@typescript-eslint/** | Integraci√≥n entre ESLint y TypeScript para an√°lisis de c√≥digo.   |
| **ESLint**        | Herramienta de linting para mantener estilo y calidad del c√≥digo.       |
| **Prettier**      | Formateador autom√°tico de c√≥digo coherente y legible.                   |
| **ts-node**       | Permite ejecutar directamente c√≥digo TypeScript sin compilar.           |
| **tsconfig-paths**| Soporte para path aliases definidos en tsconfig.                        |
| **typescript**    | Lenguaje principal de desarrollo.                                       |

---


## üè• Modelo de datos

El modelo de datos est√° definido en el siguiente Diagrama de Entidad-Relaci√≥n (DER), generado con **MySQL Workbench**:

![Modelo ER](./docs/DER%20clinica_dental.png)

### üß± Entidades principales

- `users`: Usuarios del sistema con credenciales, roles y estado.
- `professionals`: Profesionales de la cl√≠nica (asociados a un `user`).
- `patients`: Pacientes que pueden tener citas registradas.
- `appointments`: Citas m√©dicas con fecha, duraci√≥n, profesional, paciente, tratamiento y estado.
- `availabilities`: Disponibilidades por profesional y fecha, divididas en `slots`.
- `slots`: Franjas horarias fijas del d√≠a (ej. 10:00‚Äì10:30).
- `treatments`: Tratamientos dentales ofrecidos.

---

### üîÅ Relaciones entre entidades

- `users` ‚ü∂ `professionals` ‚Üí **OneToMany**
- `professionals` ‚ü∂ `availabilities` ‚Üí **OneToMany**
- `patients` ‚ü∂ `appointments` ‚Üí **OneToMany**
- `professionals` ‚ü∂ `appointments` ‚Üí **OneToMany**
- `treatments` ‚ü∂ `appointments` ‚Üí **OneToMany**
- `slots` ‚ü∂ `availabilities` ‚Üí **OneToMany**
- `slots` ‚ü∂ `appointments` ‚Üí **OneToMany**

---

### üìö Valores ENUM

- `status_appointments`: `Pendiente`, `Confirmada`, `Realizada`, `Cancelada`
- `rol_users`: `admin`, `dentista` (‚ö†Ô∏è futura mejora: `paciente`)
- `status_availability`: `Libre`, `Ocupado`, `No Disponible`
- `period`: `Ma√±ana`, `Tarde`
- `created_by_appointments`: `user` (actualmente siempre `admin`)

---

## üß™ Requisitos previos

- Node.js >= 18
- npm >= 9
- MySQL >= 8

---

## üöÄ Instalaci√≥n y ejecuci√≥n

```bash
# Clona el repositorio
git clone https://github.com/tuusuario/backend-clinica-dental.git
cd backend-clinica-dental

# Instala dependencias
npm install

# Crea un archivo .env con la configuraci√≥n necesaria (base de datos, JWT, etc.)

# Ejecuta el proyecto
# development
$ npm run start

# watch mode
$ npm run start:dev

# production mode
$ npm run start:prod
```
La API estar√° disponible en:
üìç http://localhost:3000

La documentaci√≥n Swagger est√° disponible en:
üìö http://localhost:3000/api
---

## üìÑ Configuraci√≥n .env

- Debes crear un archivo .env en la ra√≠z del proyecto con las siguientes variables:

    JWT_SECRET: 'my-secret-key'

- ‚ö†Ô∏è Aseg√∫rate de que tu base de datos clinica_dental est√© creada previamente en MySQL.

---

### üîê Autenticaci√≥n y roles

- Autenticaci√≥n basada en JWT.

- Al hacer login, el backend devuelve un token que debe incluirse en la cabecera Authorization para acceder a endpoints protegidos.

    Authorization: Bearer <tu_token_jwt>

- Control de acceso por roles (admin, dentista) para limitar el uso de funcionalidades seg√∫n el tipo de usuario.

---

## üì° Endpoints principales

üîπ Auth

| M√©todo | Endpoint      | Descripci√≥n                |
| ------ | ------------- | -------------------------- |
| POST   | `/auth/login` | Autenticaci√≥n mediante JWT |


üîπ Users

| M√©todo | Endpoint                     | Descripci√≥n                |
| ------ | ---------------------------- | -------------------------- |
| POST   | `/users/alta`                | Alta de usuario            |
| GET    | `/users`                     | Obtener todos los usuarios |
| GET    | `/users/buscar/:id`          | Obtener usuario por ID     |
| PATCH  | `/users/:id/update_password` | Cambiar contrase√±a         |
| PATCH  | `/users/:id/rol_users`       | Cambiar rol de usuario     |
| PATCH  | `/users/:id/toggle_status`   | Activar/desactivar usuario |
| PATCH  | `/users/:id/username`        | Cambiar username           |

üîπ Patients

| M√©todo | Endpoint                 | Descripci√≥n                         |
| ------ | ------------------------ | ----------------------------------- |
| GET    | `/patients/all`          | Listar todos los pacientes          |
| GET    | `/patients/search/:term` | Buscar por nombre, apellido o email |
| POST   | `/patients/alta`         | Crear nuevo paciente                |
| PUT    | `/patients/update/:id`   | Actualizar paciente                 |


üîπ Professionals

| M√©todo | Endpoint                                         | Descripci√≥n                    |
| ------ | ------------------------------------------------ | ------------------------------ |
| POST   | `/professionals/alta`                            | Alta de profesional            |
| PUT    | `/professionals/actualizacion/:id_professionals` | Actualizar profesional         |
| GET    | `/professionals/all`                             | Listar todos los profesionales |
| GET    | `/professionals/por-user/:userId`                | Buscar por ID de usuario       |


üîπ Appointments (Reservas)

| M√©todo | Endpoint                              | Descripci√≥n                          |
| ------ | ------------------------------------- | ------------------------------------ |
| POST   | `/appointments/nuevaReserva`          | Crear nueva reserva                  |
| GET    | `/appointments/reservas`              | Reservas del profesional autenticado |
| GET    | `/appointments/reservas/all`          | Todas las reservas                   |
| GET    | `/appointments/reservas/todas`        | Todas las reservas (sin filtros)     |
| GET    | `/appointments/reservas-por-fechas`   | Buscar por rango de fechas           |
| GET    | `/appointments/history/:patientId`    | Historial de citas de un paciente    |
| PATCH  | `/appointments/actualizar-estado/:id` | Cambiar estado de la cita            |


üîπ Disponibilidades

| M√©todo | Endpoint                                               | Descripci√≥n                                      |
| ------ | ------------------------------------------------------ | ------------------------------------------------ |
| POST   | `/disponibilidades/genera-semana`                      | Generar para semana actual                       |
| POST   | `/disponibilidades/genera-mes`                         | Generar para un mes                              |
| GET    | `/disponibilidades/:professionalId/:date`              | Obtener disponibilidades por fecha               |
| PATCH  | `/disponibilidades/:id`                                | Cambiar estado de disponibilidad                 |
| GET    | `/disponibilidades/slots-libres/:professionalId/:date` | Slots disponibles para profesional en fecha      |
| DELETE | `/disponibilidades/limpieza/:beforeDate`               | Eliminar disponibilidades anteriores a una fecha |


üîπ Treatments

| M√©todo | Endpoint                                  | Descripci√≥n             |
| ------ | ------------------------------------------| ----------------------- |
| GET    | `/treatments/all`                         | Obtener tratamientos    |
| POST   | `/treatments/alta`                        | Crear tratamiento nuevo |
| PUT    | `/treatments/actualizar-tratamiento/:id`  | Actualizar tratamiento  |


---

## üìÅ Estructura del proyecto (simplificada)

```plaintext
src/
‚îú‚îÄ‚îÄ auth/
‚îú‚îÄ‚îÄ appointments/
‚îú‚îÄ‚îÄ patients/
‚îú‚îÄ‚îÄ professionals/
‚îú‚îÄ‚îÄ users/
‚îú‚îÄ‚îÄ availabilities/
‚îú‚îÄ‚îÄ treatments/
‚îú‚îÄ‚îÄ slots/
‚îú‚îÄ‚îÄ common/
‚îî‚îÄ‚îÄ main.ts
```

---

## üìå Notas adicionales

- La eliminaci√≥n de disponibilidades antiguas se realiza manualmente mediante un endpoint DELETE.

- Este backend se conecta con un frontend desarrollado en Angular (dental-front), alojado en un repositorio independiente en https://github.com/fran-eliot/dental-front

---

## üß© Contribuci√≥n y mejoras futuras

- A√±adir rol de paciente y registro/autogesti√≥n desde frontend

- Panel de administraci√≥n m√°s completo

- Tests autom√°ticos

- Soporte para internacionalizaci√≥n

## üßë‚Äçüíª Autores

Este proyecto ha sido desarrollado como parte de un sistema completo de gesti√≥n cl√≠nica dental, para el curso "Desarrollo Frontend con Angular" de Fundaci√≥n Adecco.

Los autores del proyecto son:
- [Ainhoa Alonso](https://github.com/AinhoaAlonso)
- [Fran Ram√≠rez](https://github.com/fran-eliot)
- [Asusalin Abou](https://github.com/asusalin)

---

## üìÑ Licencia

- Este proyecto ha sido desarrollado con fines educativos. 
- No est√° destinado a uso comercial y no incluye una licencia expl√≠cita. 
- Para reutilizaci√≥n o distribuci√≥n, por favor contacta con los autores.

